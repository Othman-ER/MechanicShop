@using MechanicShop.Contracts.Requests

<div class="container">
    <h3 class="my-4 border-start border-5 p-1"> 
        <SpotComponent Spot="Spot" />
    </h3>
    @if (isLoading)
    {
        <div class="text-center my-3">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
    }

    <EditForm Model="@createWorkOrderRequest" OnValidSubmit="HandleSubmit">
        <DataAnnotationsValidator /> 
        <div class="mb-3">
            <label for="customer" class="form-label">Customer</label>
            <InputSelect id="customer" @bind-Value="selectedCustomerId" @bind-Value:after="LoadVehicles" class="form-select" disabled="@Disabled">
                <option value="" selected>-- Select Customer --</option>
                @if (customers?.Any() == true)
                {
                    @foreach (var customer in customers)
                    {
                        <option value="@customer.CustomerId">@customer.Name</option>
                    }
                }
            </InputSelect> 

        </div>

        <div class="mb-3">
            <label for="vehicle" class="form-label">Vehicle</label>
            <InputSelect id="vehicle" @bind-Value="createWorkOrderRequest.VehicleId" class="form-select" disabled="@(vehicles?.Any() == false)">
                <option value="" selected>-- Select Vehicle --</option>
                @if (vehicles?.Any() == true)
                {
                    @foreach (var vehicle in vehicles)
                    {
                        <option value="@vehicle.VehicleId">@vehicle.Make  | @vehicle.Model  | @vehicle.Year</option>
                    }
                }
            </InputSelect>
            @if (vehicles?.Any() == true)
            {
                <ValidationMessage For="@(() => createWorkOrderRequest.VehicleId)" />
            }
        </div>

        <div class="mb-3">
            <label for="repairTask" class="form-label">Repair task</label>  
            <RepairTaskSelector ReadOnly="@Disabled"
            ExcludedTaskIds="@createWorkOrderRequest.RepairTaskIds"
            OnTaskAdded="@OnTaskAdded"
            OnTaskRemoved="@OnTaskRemoved" />
            <ValidationMessage For="@(() => createWorkOrderRequest.RepairTaskIds)" />
        </div>

        <div class="mb-3">
            <div class="row">
                <div class="col-6 row">
                    <div class="col-6">
                        <label class="form-label">Start Date</label>
                        <InputDate @bind-Value="_localStartDate" class="form-control" />
                    </div>

                    <div class="col-6">
                        <label class="form-label">Start Time</label>
                        <InputSelect class="form-select" @bind-Value="_localStartTime">
                            @foreach (var time in TimeOptions)
                            {
                                <option value="@time">@time.ToString(@"hh\:mm")</option>
                            }
                        </InputSelect>
                    </div>
                </div>
                <div class="col-6">
                    <label for="labors" class="form-label">Labor</label>
                    <InputSelect id="labors" @bind-Value="createWorkOrderRequest.LaborId" class="form-select" disabled="@Disabled">
                        <option value="" selected> -- Labor -- </option>
                        @if (labors?.Any() == true)
                        {
                            @foreach (var labor in labors)
                            {
                                <option value="@labor.LaborId"> @labor.Name.</option>
                            }
                        }
                    </InputSelect>
                    <ValidationMessage For="@(() => createWorkOrderRequest.LaborId)" />
                </div>
            </div>
        </div>
        <div class="d-flex justify-content-end gap-3">
            <button type="button" class="btn btn-outline-secondary" @onclick="Cancel">
                <i class="bi bi-x-circle me-2"></i>Cancel
            </button>
            <button type="submit" class="btn btn-primary" disabled="@Disabled">
                <i class="bi bi-save me-2"></i>Save
            </button>
        </div>
    </EditForm>
    @if (!string.IsNullOrWhiteSpace(errorMessage))
    {
        <div class="alert alert-danger mt-3">
            <strong>Error:</strong> @errorMessage
        </div>
    }
</div>
